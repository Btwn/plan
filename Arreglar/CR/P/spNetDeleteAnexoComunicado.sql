SET DATEFIRST 7
SET ANSI_NULLS OFF
SET TRANSACTION ISOLATION LEVEL READ UNCOMMITTED
SET LOCK_TIMEOUT -1
SET QUOTED_IDENTIFIER OFF
SET NOCOUNT ON
SET IMPLICIT_TRANSACTIONS OFF
GO
ALTER PROCEDURE dbo.spNetDeleteAnexoComunicado
@ID	INT,
@AnexoBase64	AS VARCHAR(8)
AS
BEGIN
SET NOCOUNT ON
DECLARE @Ok				AS INT,
@OkRef			AS varchar(max)
BEGIN TRY
IF EXISTS(SELECT C.IDComunicado,AC.AnexoBase64 FROM pNetComunicado C JOIN pNetAnexoComunicado AC ON C.IDComunicado = AC.IDComunicado JOIN AnexoBase64 B64 ON AC.AnexoBase64 = B64.AnexoBase64 WHERE AC.IDComunicado = @ID AND AC.AnexoBase64 = @AnexoBase64)
BEGIN
DELETE FROM pNetAnexoComunicado WHERE IDComunicado = @ID AND AnexoBase64 = @AnexoBase64
DELETE FROM AnexoBase64 WHERE AnexoBase64 = @AnexoBase64
END
IF (@@rowcount <> 1)
BEGIN
SET @OK = 1
SET @OkRef = 'No hay registro(s)'
END
END TRY
BEGIN CATCH
SET @OK = 1
SET @OkRef = ERROR_MESSAGE()
END CATCH
SELECT @Ok Ok, @OkRef OkRef
SET NOCOUNT OFF
END

