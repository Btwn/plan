SET DATEFIRST 7
SET ANSI_NULLS OFF
SET TRANSACTION ISOLATION LEVEL READ UNCOMMITTED
SET LOCK_TIMEOUT -1
SET QUOTED_IDENTIFIER OFF
SET NOCOUNT ON
SET IMPLICIT_TRANSACTIONS OFF
GO
ALTER PROCEDURE spOfertaTipoOrden
@Tipo		varchar(50)

AS BEGIN
DECLARE
@Forma		varchar(50),
@Usar		varchar(50),
@Numero		int,
@Limite		int
DECLARE @Valores TABLE(Orden int NULL)
SET @Limite = 20
IF ISNULL(@Forma,'') = ''
SELECT @Forma = Forma, @Usar = Usar
FROM OfertaTipo
WHERE Tipo = @Tipo
SET @Numero = 1
WHILE @Numero <= @Limite
BEGIN
INSERT INTO @Valores(Orden)
VALUES (@Numero)
SET @Numero = @Numero + 1
END
IF UPPER(@Forma) IN('PRECIO','PRECIO/COSTO','PRECIO/LISTA','DESCUENTO')
DELETE @Valores
FROM @Valores v
JOIN OfertaTipo t ON v.Orden = t.Orden
WHERE UPPER(t.Forma) IN('PRECIO','PRECIO/COSTO','PRECIO/LISTA','DESCUENTO')
AND UPPER(t.Tipo) <> UPPER(@Tipo)
IF UPPER(@Forma) IN('IMPORTE/PUNTOS','PUNTOS','PUNTOS/PRECIO')
DELETE @Valores
FROM @Valores v
JOIN OfertaTipo t ON v.Orden = t.Orden
WHERE UPPER(t.Forma) IN('IMPORTE/PUNTOS','PUNTOS','PUNTOS/PRECIO')
AND UPPER(t.Tipo) <> UPPER(@Tipo)
IF UPPER(@Forma) IN('COMISION','OBSEQUIO MISMO ARTICULO','OBSEQUIO OTRO ARTICULO','PRECIO SIMILAR','DESCUENTO CASCADA','MISMO ARTICULO POR MONTO','OTRO ARTICULO POR MONTO')
DELETE @Valores
FROM @Valores v
JOIN OfertaTipo t ON v.Orden = t.Orden
WHERE UPPER(t.Forma) IN('COMISION','OBSEQUIO MISMO ARTICULO','OBSEQUIO OTRO ARTICULO','PRECIO SIMILAR','DESCUENTO CASCADA','MISMO ARTICULO POR MONTO','OTRO ARTICULO POR MONTO')
AND UPPER(t.Tipo) <> UPPER(@Tipo)
SELECT Orden FROM @Valores
RETURN
END

