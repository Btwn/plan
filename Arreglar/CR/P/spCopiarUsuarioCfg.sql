SET DATEFIRST 7
SET ANSI_NULLS OFF
SET TRANSACTION ISOLATION LEVEL READ UNCOMMITTED
SET LOCK_TIMEOUT -1
SET QUOTED_IDENTIFIER OFF
SET NOCOUNT ON
SET IMPLICIT_TRANSACTIONS OFF
GO
ALTER PROCEDURE spCopiarUsuarioCfg
@UsuarioD    char(10),
@UsuarioA	char(10)

AS BEGIN
DELETE UsuarioAlm WHERE Usuario = @UsuarioA
INSERT UsuarioAlm (Usuario, Almacen) SELECT @UsuarioA, Almacen FROM UsuarioAlm WHERE Usuario = @UsuarioD
DELETE UsuarioPrecios WHERE Usuario = @UsuarioA
INSERT UsuarioPrecios (Usuario, ListaPrecios) SELECT @UsuarioA, ListaPrecios FROM UsuarioPrecios WHERE Usuario = @UsuarioD
DELETE UsuarioSucursalAcceso WHERE Usuario = @UsuarioA
INSERT UsuarioSucursalAcceso (Usuario, Sucursal) SELECT @UsuarioA, Sucursal FROM UsuarioSucursalAcceso WHERE Usuario = @UsuarioD
DELETE UsuarioMovCancelacionEx WHERE Usuario = @UsuarioA
INSERT UsuarioMovCancelacionEx (Usuario, Modulo, Mov) SELECT @UsuarioA, Modulo, Mov FROM UsuarioMovCancelacionEx WHERE Usuario = @UsuarioD
DELETE UsuarioMovImporteMaximo WHERE Usuario = @UsuarioA
INSERT UsuarioMovImporteMaximo (Usuario, Modulo, Mov, ImporteMaximo, NoDeducibleMaximo, DescuentoGlobalMaximo, DescuentoLineaMaximo) SELECT @UsuarioA, Modulo, Mov, ImporteMaximo, NoDeducibleMaximo, DescuentoGlobalMaximo, DescuentoLineaMaximo FROM UsuarioMovImporteMaximo WHERE Usuario = @UsuarioD
DELETE UsuarioModuloEx WHERE Usuario = @UsuarioA
INSERT UsuarioModuloEx (Usuario, Modulo, BloquearFiltroSucursal) SELECT @UsuarioA, Modulo, BloquearFiltroSucursal FROM UsuarioModuloEx WHERE Usuario = @UsuarioD
/*
DELETE UsuarioImpresora WHERE Usuario = @UsuarioA
INSERT UsuarioImpresora (Usuario, Impresora, Orden) SELECT @UsuarioA, Impresora, Orden FROM UsuarioImpresora WHERE Usuario = @UsuarioD
*/
UPDATE a
SET 
DefAgente		= d.DefAgente,
DefAlmacen		= d.DefAlmacen,
DefAlmacenTrans		= d.DefAlmacenTrans,
DefCtaDinero		= d.DefCtaDinero,
DefCtaDineroTrans	= d.DefCtaDineroTrans,
DefMoneda		= d.DefMoneda,
DefProyecto		= d.DefProyecto,
DefLocalidad		= d.DefLocalidad,
DefCliente		= d.DefCliente,
DefActividad		= d.DefActividad,
DefMovVentas		= d.DefMovVentas,
DefZonaImpuesto		= d.DefZonaImpuesto,
Afectar			= d.Afectar,
Cancelar		= d.Cancelar,
Desafectar		= d.Desafectar,
Autorizar		= d.Autorizar,
AutorizarVenta		= d.AutorizarVenta,
AutorizarCompra		= d.AutorizarCompra,
AutorizarCxp		= d.AutorizarCxp,
AutorizarGasto		= d.AutorizarGasto,
AutorizarDinero	        = d.AutorizarDinero,
AutorizarPV             = d.AutorizarPV,
AutorizarSeriesLotes	= d.AutorizarSeriesLotes,
AutorizarGestion        = d.AutorizarGestion,
AfectarOtrosMovs	= d.AfectarOtrosMovs,
CancelarOtrosMovs	= d.CancelarOtrosMovs,
ConsultarOtrosMovs	= d.ConsultarOtrosMovs,
ConsultarOtrosMovsGrupo = d.ConsultarOtrosMovsGrupo,
ModificarOtrosMovs	= d.ModificarOtrosMovs,
ModificarVencimientos	= d.ModificarVencimientos,
ModificarEntregas	= d.ModificarEntregas,
ModificarFechaRequerida = d.ModificarFechaRequerida,
ModificarEnvios		= d.ModificarEnvios,
ModificarReferencias	= d.ModificarReferencias,
ModificarAlmacenEntregas= d.ModificarAlmacenEntregas,
ModificarSituacion	= d.ModificarSituacion,
ModificarAgente		= d.ModificarAgente,
ModificarUsuario	= d.ModificarUsuario,
ModificarListaPrecios	= d.ModificarListaPrecios,
ModificarZonaImpuesto	= d.ModificarZonaImpuesto,
ModificarSucursalDestino= d.ModificarSucursalDestino,
ConsultarOtrasEmpresas  = d.ConsultarOtrasEmpresas,
ConsultarOtrasSucursales= d.ConsultarOtrasSucursales,
AgregarCteExpress	= d.AgregarCteExpress,
AgregarArtExpress	= d.AgregarArtExpress,
Costos			= d.Costos,
BloquearCostos		= d.BloquearCostos,
VerInfoDeudores		= d.VerInfoDeudores,
VerInfoAcreedores	= d.VerInfoAcreedores,
VerComisionesPendientes	= d.VerComisionesPendientes,
BloquearEncabezadoVenta	= d.BloquearEncabezadoVenta,
BloquearCxcCtaDinero	= d.BloquearCxcCtaDinero,
BloquearCxpCtaDinero	= d.BloquearCxpCtaDinero,
BloquearDineroCtaDinero	= d.BloquearDineroCtaDinero,
EnviarExcel		= d.EnviarExcel,
ImprimirMovs		= d.ImprimirMovs,
PreliminarMovs		= d.PreliminarMovs,
Reservar		= d.Reservar,
DesReservar		= d.DesReservar,
Asignar			= d.Asignar,
DesAsignar		= d.DesAsignar,
ModificarAlmacenPedidos	= d.ModificarAlmacenPedidos,
ModificarConceptos	= d.ModificarConceptos,
BloquearPrecios		= d.BloquearPrecios,
BloquearDescGlobal	= d.BloquearDescGlobal,
BloquearDescLinea	= d.BloquearDescLinea,
BloquearCondiciones	= d.BloquearCondiciones,
BloquearAlmacen		= d.BloquearAlmacen,
BloquearMoneda		= d.BloquearMoneda,
BloquearAgente		= d.BloquearAgente,
BloquearFechaEmision	= d.BloquearFechaEmision,
BloquearProyecto	= d.BloquearProyecto,
AccesarOtrasSucursalesEnLinea = d.AccesarOtrasSucursalesEnLinea,
AfectarOtrasSucursalesEnLinea = d.AfectarOtrasSucursalesEnLinea,
DefCajero		= d.DefCajero,
DefEmpresa		= d.DefEmpresa,
ContrasenaFecha		= d.ContrasenaFecha,
BloquearCobroInmediato	= d.BloquearCobroInmediato,
ConsultarCompraPendiente= d.ConsultarCompraPendiente,
Refacturar              = d.Refacturar,
DefListaPreciosEsp	= d.DefListaPreciosEsp,
LimiteTableroControl	= d.LimiteTableroControl,
CteInfo			= d.CteInfo,
CteBloquearOtrosDatos   = d.CteBloquearOtrosDatos,
ArtBloquearOtrosDatos   = d.ArtBloquearOtrosDatos,
CteSucursalVenta	= d.CteSucursalVenta,
ImpresionInmediata	= d.ImpresionInmediata,
CambioValidarCobertura  = d.CambioValidarCobertura,
AccesoTotalCuentas      = d.AccesoTotalCuentas,
MostrarCampos		= d.MostrarCampos,
AsistentePrecios	= d.AsistentePrecios,
CambioVerPosicionEmpresa= d.CambioVerPosicionEmpresa,
CambioVerPosicionSucursal=d.CambioVerPosicionSucursal,
CambioVerPosicionOtraSucursal=d.CambioVerPosicionOtraSucursal,
CambioAutorizarOperacionLimite=d.CambioAutorizarOperacionLimite,
AutoDobleCapturaPrecios = d.AutoDobleCapturaPrecios,
AutoArtGrupo            = d.AutoArtGrupo,
AutoAgregarRecaudacionConsumo = d.AutoAgregarRecaudacionConsumo,
AutoDiesel	        = d.AutoDiesel,
BloquearActividad	= d.BloquearActividad,
UEN			= d.UEN,
CteMov			= d.CteMov,
CteArt			= d.CteArt,
ProvMov			= d.ProvMov,
ArtMov			= d.ArtMov,
DefContUso		= d.DefContUso,
BloquearContUso		= d.BloquearContUso,
ModificarReferenciasSiempre = d.ModificarReferenciasSiempre,
Observaciones           = d.Observaciones,
TraspasarTodo		= d.TraspasarTodo,
ModificarAgenteCxcPendiente = d.ModificarAgenteCxcPendiente,
BloquearNotasNegativas  = d.BloquearNotasNegativas,
ModificarSerieLoteProp  = d.ModificarSerieLoteProp,
NominaEliminacionParcial= d.NominaEliminacionParcial,
CtaDineroInfo           = d.CtaDineroInfo,
ModificarProyUENActCC   = d.ModificarProyUENActCC,
DefFormaPago		= d.DefFormaPago,
BloquearFormaPago	= d.BloquearFormaPago,
PVAbrirCajonSiempre	= d.PVAbrirCajonSiempre,
PVBloquearEgresos	= d.PVBloquearEgresos,
PVCobrarNotasEstatusBorrador = d.PVCobrarNotasEstatusBorrador,
PVModificarEstatusBorrador   = d.PVModificarEstatusBorrador,
ModificarPropiedadesLotes    = d.ModificarPropiedadesLotes,
BloquearPersonalCfg     = d.BloquearPersonalCfg,
ModificarMovsNominaVigentes = d.ModificarMovsNominaVigentes,
BloquearFacturacionDirecta  = d.BloquearFacturacionDirecta,
BloquearInvSalidaDirecta    = d.BloquearInvSalidaDirecta,
ModificarDatosVIN           = d.ModificarDatosVIN,
ModificarDatosCliente       = d.ModificarDatosCliente,
CxcExpress		    = d.CxcExpress,
CxpExpress		    = d.CxpExpress,
SubModuloAtencion           = d.SubModuloAtencion,
BloquearCancelarFactura	    = d.BloquearCancelarFactura,
CambioPresentacionExpress   = d.CambioPresentacionExpress,
ModificarConsecutivos       = d.ModificarConsecutivos,
ModificarVINFechaBaja	    = d.ModificarVINFechaBaja,
ModificarVINFechaPago	    = d.ModificarVINFechaPago,
ModificarVINAccesorio	    = d.ModificarVINAccesorio,
PVEditarNota		    = d.PVEditarNota,
ModificarDescGlobalImporte  = d.ModificarDescGlobalImporte,
ConsultarClientesOtrosAgentes=d.ConsultarClientesOtrosAgentes,
ACLCUsoEspecifico           = d.ACLCUsoEspecifico,
ACEditarTablaAmortizacion   = d.ACEditarTablaAmortizacion,
PlantillasOffice	    = d.PlantillasOffice,
ConfigPlantillasOffice	    = d.ConfigPlantillasOffice,
BloquearArtMaterial	    = d.BloquearArtMaterial,
InfoPath		    = d.InfoPath,
InfoPathExe		    = d.InfoPathExe,
ContrasenaNuncaExpira	    = d.ContrasenaNuncaExpira,
FEA			    = d.FEA,
FEACertificado		    = d.FEACertificado,
FEALlave		    = d.FEALlave,
AgregarProvExpress          = d.AgregarProvExpress,
Menu			    = d.Menu,
MenuAccesoTotal		    = d.MenuAccesoTotal,
BloquearPDF		    = d.BloquearPDF,
VerificarOrtografia	    = d.VerificarOrtografia,
ContSinOrigen               = d.ContSinOrigen,
UnidadOrganizacional	    = d.UnidadOrganizacional,
ProyMov			    = d.ProyMov,
CompraDevTodo		    = d.CompraDevTodo,
BloquearWebContenido	    = d.BloquearWebContenido,
BloquearWebHTML		    = d.BloquearWebHTML,
DBMailPerfil		    = d.DBMailPerfil,
InformacionConfidencial	    = d.InformacionConfidencial,
PerfilForma		    = d.PerfilForma,
Licenciamiento		    = d.Licenciamiento,
SituacionArea		    = d.SituacionArea,
ModificarTipoImpuesto	= d.ModificarTipoImpuesto,
AfectarCORTE			= d.AfectarCORTE
FROM Usuario a, Usuario d
WHERE a.Usuario = @UsuarioA AND d.Usuario = @UsuarioD
UPDATE a
SET 
CxcMovExpress 		     	= d.CxcMovExpress,
CxpMovExpress		     	= d.CxpMovExpress,
ModificarAnexosMovConcluidos 	= d.ModificarAnexosMovConcluidos,
ControlAlmacenes		= d.ControlAlmacenes,
ControlAlmacenesEnAlm		= d.ControlAlmacenesEnAlm,
ControlListasPrecios		= d.ControlListasPrecios,
ModificarObservaciones		= d.ModificarObservaciones,
BloquearMonedaArtPrecio		= d.BloquearMonedaArtPrecio,
BloquearMonedaArtCosto		= d.BloquearMonedaArtCosto,
AfectarLote			= d.AfectarLote,
CancelarLote			= d.CancelarLote,
ContabilizarLote		= d.ContabilizarLote,
GastoModificarProrrateo		= d.GastoModificarProrrateo,
LimitarCompraLocal		= d.LimitarCompraLocal,
VentaSugerirDisponible		= d.VentaSugerirDisponible,
CompraSugerirDisponible		= d.CompraSugerirDisponible,
Digitalizar			= d.Digitalizar,
AutorizarProdAvances		= d.AutorizarProdAvances,
ModificarProdCostosAd		= d.ModificarProdCostosAd,
ModificarClienteBackOrder	= d.ModificarClienteBackOrder,
InvFisicoAlmacen		= d.InvFisicoAlmacen,
PedidoGenerarOT			= d.PedidoGenerarOT,
PedidoGenerarOTAbrir            = d.PedidoGenerarOTAbrir,
BloquearMaestrosPersonal	= d.BloquearMaestrosPersonal,
GastosPV			= d.GastosPV,
CompraGenerarOrdenesAlProcesar	= d.CompraGenerarOrdenesAlProcesar,
GastosEditarDeducible		= d.GastosEditarDeducible,
PlanEditarOrdenes		= d.PlanEditarOrdenes,
TraspasarMovimientos		= d.TraspasarMovimientos,
BloquearAltaExpressPersonal     = d.BloquearAltaExpressPersonal,
CancelarEmbarquesExplorador	= d.CancelarEmbarquesExplorador,
OcultarDineroCtaDineroSaldo     = d.OcultarDineroCtaDineroSaldo,
RecibirDemasSinLimites		= d.RecibirDemasSinLimites,
ModificarFactorMovTipo          = d.ModificarFactorMovTipo,
BloquearListaMateriales		= d.BloquearListaMateriales,
VINTransferirComponentes	= d.VINTransferirComponentes,
ModificarEstatusCuotaCx		= d.ModificarEstatusCuotaCx,
ModificarGestionAgenda		= d.ModificarGestionAgenda,
AgendaAccesoOtrosModulos	= d.AgendaAccesoOtrosModulos,
InterfazExentus             = d.InterfazExentus,
AccesoInterfazExentus       = d.AccesoInterfazExentus
FROM UsuarioCfg2 a, UsuarioCfg2 d
WHERE a.Usuario = @UsuarioA AND d.Usuario = @UsuarioD
EXEC xpCopiarUsuarioCfg @UsuarioD, @UsuarioA
/* Se integra planograma WMS */
UPDATE a
SET a.vic_VerPlanoGramaDiseno        = d.vic_VerPlanoGramaDiseno,
a.vic_VerPlanoGramaProduccion    = d.vic_VerPlanoGramaProduccion,
a.vic_CopiarAccionesPlanoGrama   = d.vic_CopiarAccionesPlanoGrama,
a.vic_ActualizarPlanoGrama       = d.vic_ActualizarPlanoGrama,
a.vic_EliminarPlanoGrama         = d.vic_EliminarPlanoGrama,
a.vic_AccionesPlanoGrama         = d.vic_AccionesPlanoGrama,
a.VicAgregaCondic                = d.VicAgregaCondic,
a.VicActualizaCondic             = d.VicActualizaCondic,
a.VicInactivaCondic              = d.VicInactivaCondic,
a.VicEliminaCondic               = d.VicEliminaCondic
FROM Usuario a, Usuario d
WHERE a.Usuario = @UsuarioA AND d.Usuario = @UsuarioD
IF NOT EXISTS(SELECT 1 FROM vic3DescUsuarioCarpeta u WHERE u.Usuario = @UsuarioA)
BEGIN
INSERT vic3DescUsuarioCarpeta (
Usuario  , Contrato, Generales, FirFisica, Fiador, Fianza, Fechas, CondRenta, CondVenta, CondServicio, Condiciones, Relaciones, Minutas, Solicitudes, Tramites, Prorrogas, Caracteristicas, Documento, Tareas, Comentarios, CondContrac, Locales, Extra)
SELECT @UsuarioA,        0,         0,         0,      0,      0,      0,         0,         0,            0,           0,          0,       0,           0,        0,         0,               0,         0,      0,           0,           0,       0,     0
END
UPDATE a
SET a.Contrato				= b.Contrato,
a.Generales				= b.Generales,
a.FirFisica				= b.FirFisica,
a.Fiador					= b.Fiador,
a.Fianza					= b.Fianza,
a.Fechas					= b.Fechas,
a.CondRenta				= b.CondRenta,
a.CondVenta				= b.CondVenta,
a.CondServicio			= b.CondServicio,
a.Condiciones			= b.Condiciones,
a.Relaciones				= b.Relaciones,
a.Minutas				= b.Minutas,
a.Solicitudes			= b.Solicitudes,
a.Tramites				= b.Tramites,
a.Prorrogas				= b.Prorrogas,
a.Caracteristicas		= b.Caracteristicas,
a.Documento				= b.Documento,
a.Tareas					= b.Tareas,
a.Comentarios			= b.Comentarios,
a.CondContrac			= b.CondContrac,
a.Locales				= b.Locales,
a.Extra					= b.Extra
FROM vic3DescUsuarioCarpeta a,
vic3DescUsuarioCarpeta b
WHERE a.Usuario = @UsuarioA
AND b.Usuario = @UsuarioD
RETURN
END

