SET DATEFIRST 7
SET ANSI_NULLS OFF
SET TRANSACTION ISOLATION LEVEL READ UNCOMMITTED
SET LOCK_TIMEOUT -1
SET QUOTED_IDENTIFIER OFF
SET NOCOUNT ON
SET IMPLICIT_TRANSACTIONS OFF
GO
ALTER PROCEDURE speDocInTextoVerificar
@XML		varchar(max),
@Texto          varchar(max),
@Existe         bit = 0 OUTPUT,
@Ok             int = NULL OUTPUT,
@OkRef          varchar(255) = NULL OUTPUT

AS BEGIN
IF NULLIF(@OK,0) IS NULL AND NULLIF(CONVERT(varchar,@XML),'') IS NULL SELECT @Ok = 72340 ELSE
IF NULLIF(@OK,0) IS NULL AND NULLIF(CONVERT(varchar,@Texto),'') IS NULL SELECT @Ok = 72350
SET @Texto = '%'+@Texto+'%'
SET @Existe = 0
IF (SELECT PATINDEX(@Texto,@xml))  <> 0 AND @Ok IS NULL
SET @Existe = 1
ELSE
SET @Existe = 0
END

