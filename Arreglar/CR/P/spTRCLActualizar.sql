SET DATEFIRST 7
SET ANSI_NULLS OFF
SET TRANSACTION ISOLATION LEVEL READ UNCOMMITTED
SET LOCK_TIMEOUT -1
SET QUOTED_IDENTIFIER OFF
SET NOCOUNT ON
SET IMPLICIT_TRANSACTIONS OFF
GO
ALTER PROCEDURE spTRCLActualizar

AS BEGIN
DECLARE
@Tabla	varchar(100),
@Tipo	varchar(100),
@TRCL	bit,
@Activar	bit
SELECT @TRCL = TRCL FROM Version
DECLARE crTRCLActualizar CURSOR LOCAL FOR
SELECT SysTabla, Tipo
FROM SysTabla
OPEN crTRCLActualizar
FETCH NEXT FROM crTRCLActualizar INTO @Tabla, @Tipo
WHILE @@FETCH_STATUS <> -1
BEGIN
IF @@FETCH_STATUS <> -2 AND dbo.fnTablaExiste(@Tabla) = 1
BEGIN
SELECT @Activar = 0
IF @TRCL = 1 AND @Tipo IN ('Maestro', 'Cuenta') AND @Tabla NOT IN (SELECT SysTabla FROM SysTabla WHERE FueraLinea = 1)
SELECT @Activar = 1
EXEC spTRCLActivarTabla @Tabla, @Activar
END
FETCH NEXT FROM crTRCLActualizar INTO @Tabla, @Tipo
END
CLOSE crTRCLActualizar
DEALLOCATE crTRCLActualizar
RETURN
END

