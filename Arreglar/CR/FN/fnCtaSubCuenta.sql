SET DATEFIRST 7
SET ANSI_NULLS OFF
SET TRANSACTION ISOLATION LEVEL READ UNCOMMITTED
SET LOCK_TIMEOUT -1
SET QUOTED_IDENTIFIER OFF
SET NOCOUNT ON
SET IMPLICIT_TRANSACTIONS OFF
GO
ALTER FUNCTION fnCtaSubCuenta (@Cuenta varchar(20))
RETURNS varchar(20)

AS BEGIN
DECLARE
@Rama	char(20),
@Tipo	char(15)
SELECT @Cuenta = Cuenta, @Rama = NULLIF(RTRIM(Rama), ''), @Tipo = Tipo FROM Cta WHERE Cuenta = @Cuenta
WHILE UPPER(@Tipo) <> 'SUBCUENTA' AND @Rama IS NOT NULL
SELECT @Cuenta = Cuenta, @Rama = NULLIF(RTRIM(Rama), ''), @Tipo = Tipo FROM Cta WHERE Cuenta = @Rama
RETURN (@Cuenta)
END

