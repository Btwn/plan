SET DATEFIRST 7
SET ANSI_NULLS OFF
SET TRANSACTION ISOLATION LEVEL READ UNCOMMITTED
SET LOCK_TIMEOUT -1
SET QUOTED_IDENTIFIER OFF
SET NOCOUNT ON
SET IMPLICIT_TRANSACTIONS OFF
GO
ALTER FUNCTION dbo.fnIDDelMovimientoMAVI(
@Mov		varchar(20),
@MovID		varchar(20)
)
RETURNS int
AS
BEGIN
DECLARE
@ID		int
SELECT @ID = 0
IF EXISTS(SELECT ID FROM Cxc WHERE Mov = @Mov AND MovID = @MovID AND Estatus IN('PENDIENTE','CONCLUIDO'))
SELECT @ID = ID
FROM Cxc
WHERE Mov = @Mov AND MovID = @MovID AND Estatus IN('PENDIENTE','CONCLUIDO')
ELSE
SELECT TOP 1 @ID = ID
FROM Cxc
WHERE Mov = @Mov AND MovID = @MovID AND Estatus = 'CANCELADO'
RETURN (@ID)
END

