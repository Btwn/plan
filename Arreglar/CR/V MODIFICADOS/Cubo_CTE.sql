SET DATEFIRST 7
SET ANSI_NULLS OFF
SET TRANSACTION ISOLATION LEVEL READ UNCOMMITTED
SET LOCK_TIMEOUT -1
SET QUOTED_IDENTIFIER OFF
SET NOCOUNT ON
SET IMPLICIT_TRANSACTIONS OFF
GO
ALTER VIEW Cubo_CTE

AS
SELECT
'NoCliente'	= 1,
CTE.Cliente,
CTE.Rama,
CTE.Nombre,
CTE.NombreCorto,
CTE.Direccion,
CTE.EntreCalles,
CTE.Plano,
CTE.Observaciones,
CTE.Delegacion,
CTE.Colonia,
CTE.Poblacion,
CTE.Estado,
CTE.Pais,
CTE.Zona,
CTE.CodigoPostal,
CTE.RFC,
CTE.CURP,
CTE.Telefonos,
CTE.Fax,
CTE.PedirTono,
CTE.Contacto1,
CTE.Contacto2,
CTE.Extencion1,
CTE.Extencion2,
CTE.eMail1,
CTE.eMail2,
CTE.DirInternet,
CTE.Categoria,
CTE.Grupo,
CTE.Familia,
CTE.Credito,
DiaRevision1,
DiaRevision2,
HorarioRevision,
DiaPago1,
DiaPago2,
HorarioPago,
ZonaImpuesto,
PedidosParciales,
CTE.Tipo,
Situacion,
SituacionFecha,
Descuento,
CTE.Agente,
'AgenteNombre'	= agente.Nombre,
CTE.Agente3,
'Fuente'		= agente3.Nombre,
AgenteServicio,
EnviarA,
Proyecto,
FormaEnvio,
Condicion,
Ruta,
ListaPrecios,
ListaPreciosEsp,
DefMoneda,
VtasConsignacion,
AlmacenVtasConsignacion,
CTE.Clase,
CTE.Estatus,
CTE.UltimoCambio,
CTE.Alta,
'Año'		= YEAR(CTE.Alta),
'Mes'		= CASE MONTH(CTE.Alta)
WHEN 1		THEN '01 Enero'
WHEN 2		THEN '02 Febrero'
WHEN 3		THEN '03 Marzo'
WHEN 4		THEN '04 Abril'
WHEN 5		THEN '05 Mayo'
WHEN 6		THEN '06 Junio'
WHEN 7		THEN '07 Julio'
WHEN 8		THEN '08 Agosto'
WHEN 9		THEN '09 Septiembre'
WHEN 10		THEN '10 Octubre'
WHEN 11		THEN '11 Noviembre'
WHEN 12		THEN '12 Diciembre'
END,
CTE.Conciliar,
CTE.Mensaje,
Numero,
Contrasena,
Contrasena2,
wVerDisponible,
wVerArtListaPreciosEsp,
ChecarCredito,
BloquearMorosos,
ModificarVencimiento,
CreditoEspecial,
CreditoConLimite,
CreditoLimite,
CreditoConLimitePedidos,
CreditoLimitePedidos,
CreditoMoneda,
CreditoConDias,
CreditoDias,
CreditoConCondiciones,
CreditoCondiciones,
CTE.TieneMovimientos,
Cobrador,
PersonalCobrador,
DescuentoRecargos,
RecorrerVencimiento,
CTE.AlmacenDef,
CTE.SucursalEmpresa,
CTE.NivelAcceso,
Idioma,
BonificacionTipo,
Bonificacion,
VigenciaDesde,
VigenciaHasta,
Descripcion1,
Descripcion2,
Descripcion3,
Descripcion4,
Descripcion5,
Descripcion6,
Descripcion7,
Descripcion8,
Descripcion9,
Descripcion10,
Descripcion11,
Descripcion12,
Descripcion13,
Descripcion14,
Descripcion15,
Descripcion16,
Descripcion17,
Descripcion18,
Descripcion19,
Descripcion20,
FormasPagoRestringidas,
PreciosInferioresMinimo,
CBDir,
PersonalNombres,
PersonalApellidoPaterno,
PersonalApellidoMaterno,
PersonalDireccion,
PersonalEntreCalles,
PersonalPlano,
PersonalDelegacion,
PersonalColonia,
PersonalPoblacion,
PersonalEstado,
PersonalPais,
PersonalZona,
PersonalCodigoPostal,
PersonalTelefonos,
PersonalTelefonoMovil,
FechaNacimiento,
Titulo,
EstadoCivil,
FechaMatrimonio,
Conyuge,
Sexo,
Fuma,
Profesion,
Puesto,
NumeroHijos,
Alergias,
Religion,
Responsable,
Parentesco,
FacturarCte,
FacturarCteEnviarA,
Aseguradora,
NombreAsegurado,
PolizaTipo,
PolizaNumero,
PolizaReferencia,
PolizaImporte,
Deducible,
DeducibleMoneda,
Coaseguro,
Espacio,
OtrosCargos,
Flotilla,
FordDistribuidor,
FordZona,
CRMImporte,
CRMCantidad,
CRMEtapa,
CRMCierreProbabilidad,
CRMCierreFechaAprox,
CRMPresupuestoAsignado,
CRMCompetencia,
CRMInfluencia,
CRMFuente,
Fecha1,
Fecha2,
Fecha3,
Fecha4,
Fecha5,
EsProveedor,
EsPersonal,
EsAgente,
EsAlmacen,
EsEspacio,
EsCentroCostos,
EsProyecto,
EsCentroTrabajo,
EsEstacionTrabajo,
Usuario,
Licencias,
LicenciasTipo,
LicenciasLlave,
Cuenta,
CuentaRetencion,
FiscalRegimen,
ExcentoISAN,
PedidoDef,
CTE.eMailAuto,
RutaOrden,
CTE.DireccionNumero,
TelefonosLada,
PersonalTelefonosLada,
IEPS,
wMovVentas,
PITEX,
'PST'	= CASE CTE.Rama
WHEN '04-01-01'	THEN 'PST'
WHEN '04-01-02'	THEN 'PST'
WHEN '04-01-03'	THEN 'PST'
ELSE 'VACIAS' END,
'AgenteGrupo' 	= Agente.Grupo
FROM CTE WITH (NOLOCK)
LEFT OUTER JOIN Agente WITH (NOLOCK) ON  agente.Agente = cte.agente
LEFT OUTER JOIN Agente Agente3 WITH (NOLOCK) ON  agente3.Agente = cte.agente3

