SET DATEFIRST 7
SET ANSI_NULLS OFF
SET TRANSACTION ISOLATION LEVEL READ UNCOMMITTED
SET LOCK_TIMEOUT -1
SET QUOTED_IDENTIFIER OFF
SET NOCOUNT ON
SET IMPLICIT_TRANSACTIONS OFF
GO
ALTER TRIGGER tgAutoRolBC ON AutoRol

FOR UPDATE, DELETE
AS BEGIN
DECLARE
@RolN 	varchar(50),
@RolA	varchar(50)
IF dbo.fnEstaSincronizando() = 1 RETURN
SELECT @RolN = Rol FROM Inserted
SELECT @RolA = Rol FROM Deleted
IF @RolN = @RolA RETURN
IF @RolN IS NULL
BEGIN
DELETE AutoRolCargo    WHERE Rol = @RolA
DELETE AutoRolComision WHERE Rol = @RolA
END ELSE
BEGIN
UPDATE AutoRolCargo    SET Rol = @RolN WHERE Rol = @RolA
UPDATE AutoRolComision SET Rol = @RolN WHERE Rol = @RolA
END
END

